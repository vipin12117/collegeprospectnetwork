<?php    include_once ("inc/common_functions.php");    //for common function    include_once ("inc/page.inc.php");    include_once 'Video-Flv-Video-Converter.php';    session_start();    if (($_SESSION['mode'] == "") or ($_SESSION['FRONTEND_USER'] == "") or $_SESSION['mode'] != "athlete") {        header("Location:login.php");    }    $func = new COMMONFUNC;    $db = new DB;    $flag = 0;    $msg = "";        //max video size - local variable    define("MAX_SIZE", "200000");        //Increase PHP Execution Time - 600 = 60x10minutes    #ini_set('max_input_time', 600);      #ini_set('max_execution_time', 600);         //Increase PHP Execution Time - UNLIMITED    ini_set('max_input_time', 0);      ini_set('max_execution_time', 0);                 //Get Video Extension    function getExtension($str) {        $i = strrpos($str, ".");        if (!$i) {            return "";        }        $l = strlen($str) - $i;        $ext = substr($str, $i + 1, $l);        return $ext;    }        //Edit Mode    $fldId = $_REQUEST['fldId'];    if ($_GET['mode'] == 'edit' AND $fldId != "") {        $query = " Select * from " . TBL_ATHLETE_VIDEO . " where fldId =" . $fldId;        $db -> query($query);        $db -> next_record();        if ($db -> num_rows() > 0) {            $fldTitle = $db -> f('fldTitle');            $fldVideo = $db -> f('fldVideo');            $fldStatus = $db -> f('fldStatus');        }    } else {        $fldTitle = " ";        $fldVideo = " ";        $fldStatus = " ";    }        //Submit Form    if ($_POST['isSubmit'] == 'save') {        //Edit the user info        $fldTitle = $func -> input_fun($_POST['fldTitle']);        $fldStatus = $func -> input_fun($_POST['fldStatus']);        $video_upload = $_FILES['fldVideo']['name'];                if ($video_upload) {            $filename = stripslashes($_FILES['fldVideo']['name']);            $extension = getExtension($filename);            $extension = strtolower($extension);            if (($extension != "mov") && ($extension != "flv") && ($extension != "avi") && ($extension != "mp4") && ($extension != "wmv") && ($extension != "mpeg") && ($extension != "mpg")) {                $error_msg = 'Unknown Video Extension: only .mov .flv .avi .mp4 .wmv .mpeg .mpg are supported';                $flag++;            } else {                $size = filesize($_FILES['fldVideo']['tmp_name']);                if ($size > MAX_SIZE * 1024) {                    $error_msg = 'This Game Tape exceeds the 200MB Size Limit, please upload a smaller version.';                    $flag++;                }            }        } else {            $video = $db -> f('fldVideo');        }                        if ($flag == 0) {                        //Get Athlete Data            $query_Athlete = " Select * from " . TBL_ATHELETE_REGISTER . " where fldUsername ='" . $_SESSION['FRONTEND_USER'] . "'";            $db1 -> query($query_Athlete);            $db1 -> next_record();                        //Upload Video if selected            ///////////            if ($video_upload) {                $flvobj = new flv();                $flvobj -> FFLV_PATH = '/usr/bin/';                $flvobj -> APP_ROOT = 'video/';                $flvobj -> output_file = 'video/';                //$flvobj -> newname = time();                $flvobj -> newname = "cpn_" . $db1 -> f('fldId') . "-". time();  //append cpn_AthleteID- to filename                $video = $flvobj -> convert_video($_FILES['fldVideo']);                    //Check if Video has problems                if ($video == '') {                    $error_msg = 'Error occurred during Upload, please re-try using a smaller video size.';                    $flag++;                }                       }                        //Update DB Record            ///////////            $videoStatus = $func -> input_fun($_POST['fldStatus']);                        if ($videoStatus == 1) {                 //Disable all other videos for this user                $where = "fldAthleteId=".$db1 -> f('fldId');                $strDataArr=array('fldStatus' => 0);                $db->updateRec(TBL_ATHLETE_VIDEO,$strDataArr, $where);              }                                         $where = "fldId=" . $fldId;            $strDataArr = array('fldTitle' => $func -> input_fun($_POST['fldTitle']), 'fldVideo' => $video, 'fldStatus' => $func -> input_fun($_POST['fldStatus']));             $db -> updateRec(TBL_ATHLETE_VIDEO, $strDataArr, $where);           //Check if Update has problems            // if ($VideoID == '') {
                // $error_msg = 'Error occurred during Update, please re-try';
                // $flag++;
            // }                  }        //End flag check        if ($error_msg == "") {            //No Errors            header("Location:Video-List.php?msg=Game Tape successfully updated.");        }                else {            //Has Error            $fldTitle = $_REQUEST['fldTitle'];            //$fldImage      = $_REQUEST['fldPageDescraption'];            $fldVideo = $_REQUEST['fldVideo'];            $fldStatus = $_REQUEST['fldStatus'];        }    }    //END if submit?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">	<head>		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />		<title>College Prospect Network - Edit Game Tape</title>		<link href="css/style.css" rel="stylesheet" type="text/css" />		<script language="Javascript" src="/js/jquery-1.4.4.min.js"></script>		<script language="Javascript" src="javascript/functions.js"></script>				<script language="JavaScript" type="text/JavaScript">							 function SelectVideo(str) {                if(str == "") {                    document.getElementById('terms1').style.display = "block";                    document.getElementById('terms2').style.display = "block";                    return;                }                else {                    document.getElementById('terms1').style.display = "block";                    document.getElementById('terms2').style.display = "block";                    return;                }            }                		            function validate() {                var error_msg = "";                //var blnResult = true;                if(trimString(document.frmBanner.fldTitle.value) == "") {                    error_msg += "Please enter a Title. \n";                } else {                    if(hasSpecialCharaters(document.frmBanner.fldTitle.value)) {                        error_msg += "Please enter a valid Title. \n";                    }                }                if(trimString(document.frmBanner.fldVideo.value) == "") {                   //If No Video Selected                }                 else {                                 //If Video Selected                    if(!document.frmBanner.agree.checked) {                        error_msg += "You must Agree to the Terms. \n";                    }                }                                if(error_msg != '') {                    alert(error_msg);                    return false;                } else {                    if(trimString(document.frmBanner.fldVideo.value) != "") {                        $('p.loading').show();                        }                                                        $('input:submit').attr("disabled", true);                      $('input:submit').fadeTo("slow", 0.33);                    $('#btnBack').val("Cancel");                    return true;                }            }            		</script>	</head>	<body>		<?php        include ('header.php');		?>		<!--header link starts from here -->		<!--Header ends from here -->		<!--middle panel starts from here -->		<!--content panel starts from here -->		<div class="container">			<div class="innerWraper">				<div class="middle-bg">				    <div class="boxmsg" style="display:none;">                        This section is currently under Maintenance                    </div>					<div class="cantener">						<div class="register-main">							<div class="registerPage">								<form name="frmBanner" action="" method="post" enctype="multipart/form-data" onsubmit="return validate()">									<h1>Edit Game Tape</h1>																															<?php                                    if($_REQUEST['msg'])                                     {                                        ?>                                    <font class="thankyoumessage"><?php  echo $_REQUEST['msg'];?></font>                                    <?php   }?>                                                                                                         <?php                                    if($error_msg )                                    {                                    ?>                                    <font class="errormessage"><?php  echo $error_msg;?></font>                                    <?php   }?>                                                      									<p>										<label>Title:</label>										<span>										    <input type="text" name="fldTitle" value="<?php if(isset($_POST['fldTitle'])) { echo $_POST['fldTitle']; } else { echo $fldTitle; } ?>" />										</span><font color="#0000ff">&nbsp;*</font>									</p>																		<?php 									if ($_GET['type'] != 'highlight') {									    ?>									<p style="margin-top:10px;margin-bottom:0px;">										<label>Replace Video File:</label>										<span>											<input type="file" id="fldVideo" name="fldVideo" size="40"  onChange="SelectVideo(this.value);" />										</span>									</p>										<p style="padding-top:0;margin-top:0;margin-bottom:15px;">                                        <label>&nbsp;</label>                                        <span style="color:#444;line-height:18px;">                                                                                        <font style="color:#777;">*Supported Video Types:</font>&nbsp; .mov .flv .avi .mp4 .wmv .mpeg .mpg<br />                                            <font style="color:#777;">*Max Filesize:</font>&nbsp; 200 MB (204,800KB)                                        </span>                                                                   </p>                                    <br />                                      <?php } ?>                                                                                                            <p>										<label>Status:</label>										<span>											<select name="fldStatus" id="fldStatus" style="width:220px;">												<option value="1" <?php if($fldStatus==1){ ?>selected<?php }?>>Active</option>												<option value="0" <?php if($fldStatus==0){ ?>selected<?php }?>>Inactive (hide on profile)</option>											</select>										</span>									</p>									<p id="terms1" style="display:none;">                                        <label>Agree to Terms:</label>                                        <span style="width:520px;line-height:16px;padding-top:8px;color:#666">In accordance with NCAA regulations, the video you upload may only be from a high school game. No videos from AAU, Select or Traveling team games are allowed. Posting one of these videos may result in the removal of your profile from the website.</span>                                    </p>                                    <p id="terms2" style="padding-bottom:0px;margin-bottom:0px;display:none;">                                        <label>&nbsp;</label>                                        <span style="color:#333;">                                            <input type="checkbox" name="agree" value="agree_terms" style="width:20px;height:18px;margin-right:5px;position:relative;top:5px;border:0px;border-radius:0;padding:0;font-family:arial;"/>                                            Yes, I have read and agree to these terms.</span>                                    </p>                                                                        <p class="loading" style="margin:0;padding-top:10px;line-height:18px;display:none;">                                        <label style="line-height:18px;">&nbsp;</label>                                        <span style="line-height:18px;">                                            <img src="/img/ajax-loader.gif" style="margin:0;vertical-align:middle;" />                                        </span>                                    </p>                                    <p class="loading" style="margin:0;padding-top:10px;padding-bottom:0px;line-height:18px;display:none;">                                        <label>&nbsp;</label>                                        <font style="font-size:12px;font-style:normal;color:#C12626;">*Upload may take several minutes depending on filesize, do not leave page until upload finishes.</font>                                    </p>                                    <p style="padding-top:15px;">										<label>&nbsp;</label>										<span>											<input type="hidden" name="isSubmit" value="save">											<input type="submit" name="submit" value="Update" />											<INPUT id="btnBack" TYPE="BUTTON" VALUE="Back" ONCLICK="history.go(-1)">										</span>									</p>								</form>							</div>						</div>					</div>				</div>			</div>		</div>		<?php            include ('footer.php');		?>	</body></html>